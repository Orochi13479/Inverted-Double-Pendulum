<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Motor Control Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        canvas {
            max-width: 600px;
        }
        #charts {
            display: flex;
            flex-wrap: wrap;
        }
        .chart-container {
            margin: 10px;
        }
    </style>
</head>
<body>
    <h1>Motor Control Dashboard</h1>
    <div id="charts">
        <div class="chart-container">
            <canvas id="positionChart"></canvas>
        </div>
        <div class="chart-container">
            <canvas id="velocityChart"></canvas>
        </div>
        <div class="chart-container">
            <canvas id="torqueChart"></canvas>
        </div>
    </div>
    <script>
        // Setup WebSocket connection
        const socket = new WebSocket("ws://localhost:9003");

        // Data arrays
        const labels = [];
        const motor1Data = {
            position: [],
            velocity: [],
            torque: []
        };
        const motor2Data = {
            position: [],
            velocity: [],
            torque: []
        };

        // Chart configurations
        const config = (label, motor1Data, motor2Data) => ({
            type: 'line',
            data: {
                labels: labels,
                datasets: [
                    {
                        label: 'Motor 1',
                        data: motor1Data,
                        borderColor: 'rgb(255, 99, 132)',
                        fill: false
                    },
                    {
                        label: 'Motor 2',
                        data: motor2Data,
                        borderColor: 'rgb(54, 162, 235)',
                        fill: false
                    }
                ]
            },
            options: {
                responsive: true,
                scales: {
                    x: {
                        type: 'linear',
                        position: 'bottom'
                    }
                }
            }
        });

        // Initialize charts
        const positionCtx = document.getElementById('positionChart').getContext('2d');
        const velocityCtx = document.getElementById('velocityChart').getContext('2d');
        const torqueCtx = document.getElementById('torqueChart').getContext('2d');

        const positionChart = new Chart(positionCtx, config('Position', motor1Data.position, motor2Data.position));
        const velocityChart = new Chart(velocityCtx, config('Velocity', motor1Data.velocity, motor2Data.velocity));
        const torqueChart = new Chart(torqueCtx, config('Torque', motor1Data.torque, motor2Data.torque));

        // WebSocket message handler
        socket.onmessage = (event) => {
            console.log("Received data:", event.data);  // Debug print
            const data = JSON.parse(event.data);
            const timestamp = data.timestamp;

            labels.push(timestamp);

            motor1Data.position.push(data.motor1_position);
            motor1Data.velocity.push(data.motor1_velocity);
            motor1Data.torque.push(data.motor1_torque);

            motor2Data.position.push(data.motor2_position);
            motor2Data.velocity.push(data.motor2_velocity);
            motor2Data.torque.push(data.motor2_torque);

            positionChart.update();
            velocityChart.update();
            torqueChart.update();
        };
    </script>
</body>
</html>
